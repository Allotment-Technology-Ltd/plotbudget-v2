---
description: Keep main and branches in sync in plotbudget; run fetch/pull and report status when user asks for sync, wrap-up, or before major commits
alwaysApply: false
---

# CI/CD and branch sync (plotbudget)

When the user asks to **sync branches**, **ensure main is synced**, **CI/CD sync**, **sync with main**, or similar, or when doing a **wrap-up** or **before committing/pushing** (if the user expects a clean state):

1. **Run all git commands from the plotbudget repo root** (the repo that contains `apps/web`, `package.json`, `.github/`, etc.). If the workspace root is above plotbudget, `cd plotbudget` first.

2. **Fetch and prune**
   - `git fetch origin --prune`
   - (Prunes deleted remote branches.)

3. **Sync local main with origin**
   - `git checkout main`
   - `git pull origin main --no-edit`
   - Then switch back to the user's branch if they were on one: `git checkout <previous-branch>`.

4. **Report briefly**
   - Confirm main is in sync with `origin/main`.
   - List branches that are ahead/behind their remotes (e.g. "feat/X behind 5", "feat/Y ahead 2").
   - If the user was on a feature branch, note whether it's up to date with its remote.

5. **Branch best practice (align with branch-before-implement)**
   - Prefer: work on a feature branch → commit → push branch → open PR to main. Do not push directly to main unless the user explicitly asks.
   - When starting implementation, create a branch from an up-to-date main when possible.

**Exclusions:** User says "don't sync" or "no branch sync". Skip sync in read-only or ask-only sessions if the user didn't ask for it.
